<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Curve fitting &mdash; HyperSpy 0.8.x+dev documentation</title>
    
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.8.x+dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../_static/hyperspy_logo.ico"/>
    <link rel="top" title="HyperSpy 0.8.x+dev documentation" href="../index.html" />
    <link rel="up" title="HyperSpy User Guide (DRAFT)" href="index.html" />
    <link rel="next" title="Electron Energy Loss Spectroscopy" href="eels.html" />
    <link rel="prev" title="Machine learning" href="mva.html" />
 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25260850-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="eels.html" title="Electron Energy Loss Spectroscopy"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="mva.html" title="Machine learning"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">HyperSpy 0.8.x+dev documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">HyperSpy User Guide (DRAFT)</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="curve-fitting">
<h1>Curve fitting<a class="headerlink" href="#curve-fitting" title="Permalink to this headline">¶</a></h1>
<p>HyperSpy can perform curve fitting in n-dimensional data sets. It can create a
model from a linear combinantion of predefined components and can use multiple
optimisation algorithms to fit the model to experimental data. It supports
bounds and weights.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7: </span>Before creating a model verify that the <code class="docutils literal"><span class="pre">Signal.binned</span></code> metadata
attribute of the signal is set to the correct value because the resulting
model depends on this parameter. See <a class="reference internal" href="tools.html#signal-binned"><span>Binned and unbinned signals</span></a> for more details.</p>
</div>
<div class="section" id="creating-a-model">
<h2>Creating a model<a class="headerlink" href="#creating-a-model" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model" title="hyperspy.model.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> can be created using the
<a class="reference internal" href="../api/hyperspy._signals.html#hyperspy._signals.spectrum.Spectrum.create_model" title="hyperspy._signals.spectrum.Spectrum.create_model"><code class="xref py py-meth docutils literal"><span class="pre">create_model()</span></code></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;YourDataFilenameHere&#39;</span><span class="p">)</span> <span class="c"># Load the data from a file</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span> <span class="c"># Create the model and asign it to the variable m</span>
</pre></div>
</div>
<p>At this point you may be prompted to provide any necessary information not
already included in the datafile, e.g.if s is EELS data, you may be asked for
the accelerating voltage, convergence and collection angles etc.</p>
</div>
<div class="section" id="adding-components-to-the-model">
<h2>Adding components to the model<a class="headerlink" href="#adding-components-to-the-model" title="Permalink to this headline">¶</a></h2>
<p>In HyperSpy a model consists of a linear combination of <a class="reference internal" href="../api/hyperspy.html#module-hyperspy.components" title="hyperspy.components"><code class="xref py py-mod docutils literal"><span class="pre">components</span></code></a>.
These are some of the components which are currently available:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.eels_cl_edge.EELSCLEdge" title="hyperspy._components.eels_cl_edge.EELSCLEdge"><code class="xref py py-class docutils literal"><span class="pre">EELSCLEdge</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.volume_plasmon_drude.VolumePlasmonDrude" title="hyperspy._components.volume_plasmon_drude.VolumePlasmonDrude"><code class="xref py py-class docutils literal"><span class="pre">VolumePlasmonDrude</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.power_law.PowerLaw" title="hyperspy._components.power_law.PowerLaw"><code class="xref py py-class docutils literal"><span class="pre">PowerLaw</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.offset.Offset" title="hyperspy._components.offset.Offset"><code class="xref py py-class docutils literal"><span class="pre">Offset</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.exponential.Exponential" title="hyperspy._components.exponential.Exponential"><code class="xref py py-class docutils literal"><span class="pre">Exponential</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.scalable_fixed_pattern.ScalableFixedPattern" title="hyperspy._components.scalable_fixed_pattern.ScalableFixedPattern"><code class="xref py py-class docutils literal"><span class="pre">ScalableFixedPattern</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.gaussian.Gaussian" title="hyperspy._components.gaussian.Gaussian"><code class="xref py py-class docutils literal"><span class="pre">Gaussian</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.lorentzian.Lorentzian" title="hyperspy._components.lorentzian.Lorentzian"><code class="xref py py-class docutils literal"><span class="pre">Lorentzian</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.voigt.Voigt" title="hyperspy._components.voigt.Voigt"><code class="xref py py-class docutils literal"><span class="pre">Voigt</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.polynomial.Polynomial" title="hyperspy._components.polynomial.Polynomial"><code class="xref py py-class docutils literal"><span class="pre">Polynomial</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.logistic.Logistic" title="hyperspy._components.logistic.Logistic"><code class="xref py py-class docutils literal"><span class="pre">Logistic</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.bleasdale.Bleasdale" title="hyperspy._components.bleasdale.Bleasdale"><code class="xref py py-class docutils literal"><span class="pre">Bleasdale</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.error_function.Erf" title="hyperspy._components.error_function.Erf"><code class="xref py py-class docutils literal"><span class="pre">Erf</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.pes_see.SEE" title="hyperspy._components.pes_see.SEE"><code class="xref py py-class docutils literal"><span class="pre">SEE</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.arctan.Arctan" title="hyperspy._components.arctan.Arctan"><code class="xref py py-class docutils literal"><span class="pre">Arctan</span></code></a></li>
</ul>
<p>However, this doesn&#8217;t mean that you have to limit yourself to this meagre list of function.</p>
<div class="versionadded" id="expression-component-label">
<p><span class="versionmodified">New in version 0.8.1: </span><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.expression.Expression" title="hyperspy._components.expression.Expression"><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></a> component</p>
</div>
<p>The easiest way to turn a mathematical expression into a component is using the
<a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.expression.Expression" title="hyperspy._components.expression.Expression"><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></a> component. For example, the
following is all you need to create a`Gaussian` component  with more sensible
parameters for spectroscopy than the one that ships with HyperSpy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span>
<span class="gp">... </span><span class="n">expression</span><span class="o">=</span><span class="s">&quot;height * exp(-(x - x0) ** 2 * 4 * log(2)/ fwhm ** 2)&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Gaussian&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">position</span><span class="o">=</span><span class="s">&quot;x0&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">fwhm</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span><span class="n">centre</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span><span class="n">module</span><span class="o">=</span><span class="s">&quot;numpy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.expression.Expression" title="hyperspy._components.expression.Expression"><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></a> uses <a class="reference external" href="http://www.sympy.org">Sympy</a> internally to turn the string into
a funtion. By default it &#8220;translates&#8221; the expression using
numpy, but often it is possible to boost performance by using
<a class="reference external" href="https://github.com/pydata/numexpr">numexpr</a> instead.</p>
<p><a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.expression.Expression" title="hyperspy._components.expression.Expression"><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></a> is only useful for analytical
functions. If you know how to write the function with Python, turning it into
a component is very easy modifying the following template:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">hyperspy.component</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="k">class</span> <span class="nc">My_Component</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameter_2</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="c"># Define the parameters</span>
        <span class="n">Component</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;parameter_1&#39;</span><span class="p">,</span> <span class="s">&#39;parameter_2&#39;</span><span class="p">))</span>

        <span class="c"># Optionally we can set the initial values</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parameter_1</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">parameter_1</span>

        <span class="c"># The units (optional)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;Tesla&#39;</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_2</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s">&#39;Kociak&#39;</span>

        <span class="c"># Once defined we can give default values to the attribute is we want</span>
        <span class="c"># For example we fix the attribure_1 (optional)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">attribute_1</span><span class="o">.</span><span class="n">free</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># And we set the boundaries (optional)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">bmin</span> <span class="o">=</span> <span class="mf">0.</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">bmax</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Optionally, to boost the optimization speed we can define also define</span>
        <span class="c"># the gradients of the function we the syntax:</span>
        <span class="c"># self.parameter.grad = function</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_parameter_1</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">parameter_2</span><span class="o">.</span><span class="n">grad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grad_parameter_2</span>

    <span class="c"># Define the function as a function of the already defined parameters, x</span>
    <span class="c"># being the independent variable value</span>
    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_1</span><span class="o">.</span><span class="n">value</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_2</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">p2</span>

    <span class="c"># Optionally define the gradients of each parameter</span>
     <span class="k">def</span> <span class="nf">grad_parameter_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Returns d(function)/d(parameter_1)</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="k">return</span> <span class="mi">0</span>

     <span class="k">def</span> <span class="nf">grad_parameter_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Returns d(function)/d(parameter_2)</span>
<span class="sd">         &quot;&quot;&quot;</span>
         <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>If you need help with the task please submit your question to the <span class="xref std std-ref">users
mailing list</span>.</p>
<div class="versionchanged" id="model-components-label">
<p><span class="versionmodified">Changed in version 0.8.1: </span>printing current model components</p>
</div>
<p>To print the current components in a model use <code class="xref py py-attr docutils literal"><span class="pre">components</span></code> of the
variable. A table with component number, attribute name, component name and
component type will be printed:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;Model, title: my signal title&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">components</span> <span class="c"># an empty model</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
</pre></div>
</div>
<p>In fact, components may be created automatically in some cases. For example, if
the <cite>Signal</cite> is recognised as EELS data, a power-law background component will
automatically be placed in the model. To add a component first we have to create an
instance of the component. Once the instance has been created we can add the
component to the model using the <code class="xref py py-meth docutils literal"><span class="pre">append()</span></code> method, e.g. for a type of
data that can be modelled using gaussians we might proceed as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span> <span class="c"># Create a Gaussian function component</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gaussian</span><span class="p">)</span> <span class="c"># Add it to the model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">components</span> <span class="c"># Print the model components</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
<span class="go">   0 |                  Gaussian |                  Gaussian |                  Gaussian</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span> <span class="c"># Create another gaussian components</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian3</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span> <span class="c"># Create a third gaussian components</span>
</pre></div>
</div>
<p>We could use the append method two times to add the two gaussians, but when
adding multiple components it is handier to use the extend method that enables
adding a list of components at once.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">gaussian2</span><span class="p">,</span> <span class="n">gaussian3</span><span class="p">))</span> <span class="c"># note the double brackets!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">components</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
<span class="go">   0 |                  Gaussian |                  Gaussian |                  Gaussian</span>
<span class="go">   1 |                Gaussian_0 |                Gaussian_0 |                  Gaussian</span>
<span class="go">   2 |                Gaussian_1 |                Gaussian_1 |                  Gaussian</span>
</pre></div>
</div>
<p>We can customise the name of the components.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Carbon&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Long Hydrogen name&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Nitrogen&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">components</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
<span class="go">   0 |                    Carbon |                    Carbon |                  Gaussian</span>
<span class="go">   1 |        Long_Hydrogen_name |        Long Hydrogen name |                  Gaussian</span>
<span class="go">   2 |                  Nitrogen |                  Nitrogen |                  Gaussian</span>
</pre></div>
</div>
<p>Two components cannot have the same name.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Carbon&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;ipython-input-5-2b5669fae54a&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
    <span class="n">g2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Carbon&quot;</span>
  File <span class="nb">&quot;/home/fjd29/Python/hyperspy/hyperspy/component.py&quot;</span>, line <span class="m">466</span>, in <span class="n">name</span>
    <span class="s">&quot;the name &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="gr">ValueError</span>: <span class="n">Another component already has the name Carbon</span>
</pre></div>
</div>
<p>It is possible to access the components in the model by their name or by the
index in the model.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
<span class="go">   0 |                    Carbon |                    Carbon |                  Gaussian</span>
<span class="go">   1 |        Long_Hydrogen_name |        Long Hydrogen name |                  Gaussian</span>
<span class="go">   2 |                  Nitrogen |                  Nitrogen |                  Gaussian</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;Carbon (Gaussian component)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s">&quot;Long Hydrogen name&quot;</span><span class="p">]</span>
<span class="go">&lt;Long Hydrogen name (Gaussian component)&gt;</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.8.1: </span><code class="xref py py-attr docutils literal"><span class="pre">components</span></code> attribute</p>
</div>
<p>In addition, the components can be accessed in the
<code class="xref py py-attr docutils literal"><span class="pre">components</span></code> <cite>Model</cite> attribute. This is specially
useful when working in interactive data analysis with IPython because it
enables tab completion.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">   # |            Attribute Name |            Component Name |            Component Type</span>
<span class="go">---- | ------------------------- | ------------------------- | -------------------------</span>
<span class="go">   0 |                    Carbon |                    Carbon |                  Gaussian</span>
<span class="go">   1 |        Long_Hydrogen_name |        Long Hydrogen name |                  Gaussian</span>
<span class="go">   2 |                  Nitrogen |                  Nitrogen |                  Gaussian</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Long_Hydrogen_name</span>
<span class="go">&lt;Long Hydrogen name (Gaussian component)&gt;</span>
</pre></div>
</div>
<p>It is possible to &#8220;switch off&#8221; a component by setting its
<code class="xref py py-attr docutils literal"><span class="pre">active</span></code> to <cite>False</cite>. When a components is
switched off, to all effects it is as if it was not part of the model. To
switch it on simply set the <code class="xref py py-attr docutils literal"><span class="pre">active</span></code> attribute
back to <cite>True</cite>.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7.1: </span><a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.active_is_multidimensional" title="hyperspy.component.Component.active_is_multidimensional"><code class="xref py py-attr docutils literal"><span class="pre">active_is_multidimensional</span></code></a></p>
</div>
<p>In multidimensional signals it is possible to store the value of the
<code class="xref py py-attr docutils literal"><span class="pre">active</span></code> attribute at each navigation index.
To enable this feature for a given component set the
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.active_is_multidimensional" title="hyperspy.component.Component.active_is_multidimensional"><code class="xref py py-attr docutils literal"><span class="pre">active_is_multidimensional</span></code></a> attribute to
<cite>True</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">active_is_multidimensional</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">_active_array</span>
<span class="go">array([ True,  True,  True,  True,  True,  True,  True,  True,  True,  True], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">_active_array</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_component_active_value</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">_active_array</span>
<span class="go">array([False, False, False, False, False, False, False, False, False, False], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_component_active_value</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">only_current</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">_active_array</span>
<span class="go">array([ True, False, False, False, False, False, False, False, False, False], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">active_is_multidimensional</span> <span class="o">=</span> <span class="bp">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">_active_array</span> <span class="ow">is</span> <span class="bp">None</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-and-setting-parameter-values-and-attributes">
<h2>Getting and setting parameter values and attributes<a class="headerlink" href="#getting-and-setting-parameter-values-and-attributes" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.print_current_values" title="hyperspy.model.Model.print_current_values"><code class="xref py py-meth docutils literal"><span class="pre">print_current_values()</span></code></a> prints the value of the
parameters of the components in the current coordinates.</p>
<p><code class="xref py py-attr docutils literal"><span class="pre">parameters</span></code> contains a list of the parameters
of a component and <code class="xref py py-attr docutils literal"><span class="pre">free_parameters</span></code> lists only
the free parameters.</p>
<p>The value of a particular parameter can be accessed in the
<code class="xref py py-attr docutils literal"><span class="pre">value</span></code>.</p>
<p>If a model contains several components with the same parameters, it is possible
to change them all by using <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_value" title="hyperspy.model.Model.set_parameters_value"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_value()</span></code></a>.
Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_value</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span>
<span class="go">array([ 20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span>
<span class="go">array([ 20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_value</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">only_current</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span>
<span class="go">array([ 40.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_value</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span> <span class="n">component_list</span><span class="o">=</span><span class="p">[</span><span class="n">g2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span>
<span class="go">array([ 30.,  30.,  30.,  30.,  30.,  30.,  30.,  30.,  30.,  30.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="s">&#39;values&#39;</span><span class="p">]</span>
<span class="go">array([ 40.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.,  20.])</span>
</pre></div>
</div>
<p>To set the the <cite>free</cite> state of a parameter change the
<code class="xref py py-attr docutils literal"><span class="pre">free</span></code> attribute. To change the <cite>free</cite> state of
all parameters in a component to <cite>True</cite> use
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.set_parameters_free" title="hyperspy.component.Component.set_parameters_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_free()</span></code></a>, and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.set_parameters_not_free" title="hyperspy.component.Component.set_parameters_not_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_not_free()</span></code></a> for setting them to
<cite>False</cite>. Specific parameter-names can also be specified by using
<cite>parameter_name_list</cite>, shown in the example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;,</span>
<span class="go">    &lt;Parameter sigma of Gaussian component&gt;,</span>
<span class="go">    &lt;Parameter centre of Gaussian component&gt;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">set_parameters_not_free</span><span class="p">()</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">set_parameters_free</span><span class="p">(</span><span class="n">parameter_name_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;centre&#39;</span><span class="p">])</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;,</span>
<span class="go">     &lt;Parameter centre of Gaussian component&gt;])</span>
</pre></div>
</div>
<p>Similar functions exist for <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model" title="hyperspy.model.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>:
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_free" title="hyperspy.model.Model.set_parameters_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_free()</span></code></a> and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_not_free" title="hyperspy.model.Model.set_parameters_not_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_not_free()</span></code></a>. Which sets the
<code class="xref py py-attr docutils literal"><span class="pre">free</span></code> states for the parameters in components
in a model. Specific components and parameter-names can also be specified. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_not_free</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_free</span><span class="p">(</span><span class="n">parameter_name_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">set_parameters_free</span><span class="p">([</span><span class="n">g1</span><span class="p">],</span> <span class="n">parameter_name_list</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;sigma&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;,</span>
<span class="go">     &lt;Parameter sigma of Gaussian component&gt;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g2</span><span class="o">.</span><span class="n">free_parameters</span>
<span class="go">set([&lt;Parameter A of Gaussian component&gt;])</span>
</pre></div>
</div>
<p>The value of a parameter can be coupled to the value of another by setting the
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Parameter.twin" title="hyperspy.component.Parameter.twin"><code class="xref py py-attr docutils literal"><span class="pre">twin</span></code></a> attribute.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian</span><span class="o">.</span><span class="n">parameters</span> <span class="c"># Print the parameters of the gaussian components</span>
<span class="go">(A, sigma, centre)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian</span><span class="o">.</span><span class="n">centre</span><span class="o">.</span><span class="n">free</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Fix the centre</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian</span><span class="o">.</span><span class="n">free_parameters</span>  <span class="c"># Print the free parameters</span>
<span class="go">set([A, sigma])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span> <span class="c"># Print the current value of all the free parameters</span>
<span class="go">Components  Parameter       Value</span>
<span class="go">Normalized Gaussian</span>
<span class="go">        A   1.000000</span>
<span class="go">        sigma       1.000000</span>
<span class="go">Normalized Gaussian</span>
<span class="go">        centre      0.000000</span>
<span class="go">        A   1.000000</span>
<span class="go">        sigma       1.000000</span>
<span class="go">Normalized Gaussian</span>
<span class="go">        A   1.000000</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        centre      0.000000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">twin</span> <span class="o">=</span> <span class="n">gaussian3</span><span class="o">.</span><span class="n">A</span> <span class="c"># Couple the A parameter of gaussian2 to the A parameter of gaussian 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># Set the gaussian2 centre value to 10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span>
<span class="go">Components  Parameter       Value</span>
<span class="go">Carbon</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   1.000000</span>
<span class="go">        centre      0.000000</span>
<span class="go">Hydrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   10.000000</span>
<span class="go">        centre      10.000000</span>
<span class="go">Nitrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   10.000000</span>
<span class="go">        centre      0.000000</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian3</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">5</span> <span class="c"># Set the gaussian1 centre value to 5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span>
<span class="go">Components  Parameter       Value</span>
<span class="go">Carbon</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   1.000000</span>
<span class="go">        centre      0.000000</span>
<span class="go">Hydrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   5.000000</span>
<span class="go">        centre      10.000000</span>
<span class="go">Nitrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   5.000000</span>
<span class="go">        centre      0.000000</span>
</pre></div>
</div>
<p>By default the coupling function is the identity function. However it is
possible to set a different coupling function by setting the
<code class="xref py py-attr docutils literal"><span class="pre">twin_function</span></code> and
<code class="xref py py-attr docutils literal"><span class="pre">twin_inverse_function</span></code> attributes.  For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">twin_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">twin_inverse_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian2</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span>
<span class="go">Components  Parameter       Value</span>
<span class="go">Carbon</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   1.000000</span>
<span class="go">        centre      0.000000</span>
<span class="go">Hydrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   4.000000</span>
<span class="go">        centre      10.000000</span>
<span class="go">Nitrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   2.000000</span>
<span class="go">        centre      0.000000</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gaussian3</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span>
<span class="go">Components  Parameter       Value</span>
<span class="go">Carbon</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   1.000000</span>
<span class="go">        centre      0.000000</span>
<span class="go">Hydrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   16.000000</span>
<span class="go">        centre      10.000000</span>
<span class="go">Nitrogen</span>
<span class="go">        sigma       1.000000</span>
<span class="go">        A   4.000000</span>
<span class="go">        centre      0.000000</span>
</pre></div>
</div>
</div>
<div class="section" id="fitting-the-model-to-the-data">
<span id="model-fitting"></span><h2>Fitting the model to the data<a class="headerlink" href="#fitting-the-model-to-the-data" title="Permalink to this headline">¶</a></h2>
<p>To fit the model to the data at the current coordinates (e.g. to fit one
spectrum at a particular point in a spectrum-image) use
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.fit" title="hyperspy.model.Model.fit"><code class="xref py py-meth docutils literal"><span class="pre">fit()</span></code></a>.</p>
<p>The following table summarizes the features of the currently available
optimizers:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Features of curve fitting optimizers.</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="11%" />
<col width="25%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Optimizer</th>
<th class="head">Bounds</th>
<th class="head">Error estimation</th>
<th class="head">Method</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#8220;leastsq&#8221;</td>
<td>No</td>
<td>Yes</td>
<td>least squares</td>
</tr>
<tr class="row-odd"><td>&#8220;mpfit&#8221;</td>
<td>Yes</td>
<td>Yes</td>
<td>least squares</td>
</tr>
<tr class="row-even"><td>&#8220;odr&#8221;</td>
<td>No</td>
<td>Yes</td>
<td>least squares</td>
</tr>
<tr class="row-odd"><td>&#8220;fmin&#8221;</td>
<td>No</td>
<td>No</td>
<td>least squares, maximum likelihood</td>
</tr>
</tbody>
</table>
<p>The following example shows how to perfom least squares with error estimation.</p>
<p>First we create data consisting of a line line <code class="docutils literal"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">a*x</span> <span class="pre">+</span> <span class="pre">b</span></code> with <code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">1</span></code>
and <code class="docutils literal"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">100</span></code> and we add white noise to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">SpectrumSimulation</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add_gaussian_noise</span><span class="p">(</span><span class="n">std</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>To fit it we create a model consisting of a
<a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.polynomial.Polynomial" title="hyperspy._components.polynomial.Polynomial"><code class="xref py py-class docutils literal"><span class="pre">Polynomial</span></code></a> component of order 1 and fit it
to the data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>On fitting completion, the optimized value of the parameters and their estimated standard deviation
are stored in the following line attributes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">value</span>
<span class="go">(0.99246156488437653, 103.67507406125888)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">std</span>
<span class="go">(0.11771053738516088, 13.541061301257537)</span>
</pre></div>
</div>
<p>When the noise is heterocedastic, only if the
<code class="docutils literal"><span class="pre">metadata.Signal.Noise_properties.variance</span></code> attribute of the
<a class="reference internal" href="../api/hyperspy._signals.html#hyperspy._signals.spectrum.Spectrum" title="hyperspy._signals.spectrum.Spectrum"><code class="xref py py-class docutils literal"><span class="pre">Spectrum</span></code></a> instance is defined can the errors be
estimated accurately. If the variance is not defined, the standard deviation of
the parameters are still computed and stored in the
<code class="xref py py-attr docutils literal"><span class="pre">std</span></code> attribute by setting variance equal 1.
However, the value won&#8217;t be correct unless an accurate value of the variance is
defined in <code class="docutils literal"><span class="pre">metadata.Signal.Noise_properties.variance</span></code>. See
<a class="reference internal" href="tools.html#signal-noise-properties"><span>Setting the noise properties</span></a> for more information.</p>
<p>In the following example, we add poissonian noise to the data instead of
gaussian noise and proceed to fit as in the previous example.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">SpectrumSimulation</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add_poissonian_noise</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span>  <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">value</span>
<span class="go">(1.0052331707848698, -1.0723588390873573)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">std</span>
<span class="go">(0.0081710549764721901, 1.4117294994070277)</span>
</pre></div>
</div>
<p>Because the noise is heterocedastic, the least squares optimizer estimation is
biased. A more accurate result can be obtained by using weighted least squares
instead that, although still biased for poissonian noise, is a good
approximation in most cases.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">estimate_poissonian_noise_variance</span><span class="p">(</span><span class="n">expected_value</span><span class="o">=</span><span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">value</span>
<span class="go">(1.0004224896604759, -0.46982916592391377)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">std</span>
<span class="go">(0.0055752036447948173, 0.46950832982673557)</span>
</pre></div>
</div>
<p>We can use poissonian maximum likelihood estimation
instead that is an unbiased estimator for poissonian noise.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fitter</span><span class="o">=</span><span class="s">&quot;fmin&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;ml&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">line</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">value</span>
<span class="go">(1.0030718094185611, -0.63590210946134107)</span>
</pre></div>
</div>
<p>Problems of ill-conditioning and divergence can be ameliorated by using bounded
optimization. Currently, only the &#8220;mpfit&#8221; optimizer supports bounds. In the
following example a gaussian histogram is fitted using a
<a class="reference internal" href="../api/hyperspy._components.html#hyperspy._components.gaussian.Gaussian" title="hyperspy._components.gaussian.Gaussian"><code class="xref py py-class docutils literal"><span class="pre">Gaussian</span></code></a> component using mpfit and bounds on
the <code class="docutils literal"><span class="pre">centre</span></code> parameter.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">signals</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<span class="go">size=1e5)).get_histogram()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">Signal</span><span class="o">.</span><span class="n">binned</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">create_model</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">centre</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">centre</span><span class="o">.</span><span class="n">bmin</span> <span class="o">=</span> <span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">centre</span><span class="o">.</span><span class="n">bmax</span> <span class="o">=</span> <span class="mi">14</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g1</span><span class="o">.</span><span class="n">centre</span><span class="o">.</span><span class="n">bounded</span> <span class="o">=</span> <span class="bp">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fitter</span><span class="o">=</span><span class="s">&quot;mpfit&quot;</span><span class="p">,</span> <span class="n">bounded</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">print_current_values</span><span class="p">()</span>
<span class="go">Components  Parameter   Value</span>
<span class="go">Gaussian</span>
<span class="go">        sigma   0.00996345</span>
<span class="go">        A   99918.7</span>
<span class="go">        centre  9.99976</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7: </span>chi-squared and reduced chi-squared</p>
</div>
<p>The chi-squared, reduced chi-squared and the degrees of freedom are
computed automatically when fitting. They are stored as signals, in the
<code class="xref py py-attr docutils literal"><span class="pre">chisq</span></code>, <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.red_chisq" title="hyperspy.model.Model.red_chisq"><code class="xref py py-attr docutils literal"><span class="pre">red_chisq</span></code></a>  and
<code class="xref py py-attr docutils literal"><span class="pre">dof</span></code> attributes of the model respectively. Note that,
unless <code class="docutils literal"><span class="pre">metadata.Signal.Noise_properties.variance</span></code> contains an accurate
estimation of the variance of the data, the chi-squared and reduced
chi-squared cannot be computed correctly. This is also true for
homocedastic noise.</p>
</div>
<div class="section" id="visualizing-the-model">
<span id="model-visualization"></span><h2>Visualizing the model<a class="headerlink" href="#visualizing-the-model" title="Permalink to this headline">¶</a></h2>
<p>To visualise the result use the <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.plot" title="hyperspy.model.Model.plot"><code class="xref py py-meth docutils literal"><span class="pre">plot()</span></code></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c"># Visualise the results</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7.</span></p>
</div>
<p>By default only the full model line is displayed in the plot. In addition, it
is possible to display the individual components by calling
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.enable_plot_components" title="hyperspy.model.Model.enable_plot_components"><code class="xref py py-meth docutils literal"><span class="pre">enable_plot_components()</span></code></a> or directly using
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.plot" title="hyperspy.model.Model.plot"><code class="xref py py-meth docutils literal"><span class="pre">plot()</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_components</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># Visualise the results</span>
</pre></div>
</div>
<p>To disable this feature call <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.disable_plot_components" title="hyperspy.model.Model.disable_plot_components"><code class="xref py py-meth docutils literal"><span class="pre">disable_plot_components()</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7.1: </span><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.suspend_update" title="hyperspy.model.Model.suspend_update"><code class="xref py py-meth docutils literal"><span class="pre">suspend_update()</span></code></a> and <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.resume_update" title="hyperspy.model.Model.resume_update"><code class="xref py py-meth docutils literal"><span class="pre">resume_update()</span></code></a></p>
</div>
<p>By default the model plot is automatically updated when any parameter value
changes. It is possible to suspend this feature with
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.suspend_update" title="hyperspy.model.Model.suspend_update"><code class="xref py py-meth docutils literal"><span class="pre">suspend_update()</span></code></a>. To resume it use
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.resume_update" title="hyperspy.model.Model.resume_update"><code class="xref py py-meth docutils literal"><span class="pre">resume_update()</span></code></a>.</p>
</div>
<div class="section" id="setting-the-initial-parameters">
<span id="model-starting"></span><h2>Setting the initial parameters<a class="headerlink" href="#setting-the-initial-parameters" title="Permalink to this headline">¶</a></h2>
<p>Non-linear regression often requires setting sensible starting
parameters. This can be done by plotting the model and adjusting the parameters
by hand.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.7: </span>In addition, it is possible to fit a given component  independently using
the <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.fit_component" title="hyperspy.model.Model.fit_component"><code class="xref py py-meth docutils literal"><span class="pre">fit_component()</span></code></a> method.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.6: </span><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.enable_adjust_position" title="hyperspy.model.Model.enable_adjust_position"><code class="xref py py-meth docutils literal"><span class="pre">enable_adjust_position()</span></code></a> and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.disable_adjust_position" title="hyperspy.model.Model.disable_adjust_position"><code class="xref py py-meth docutils literal"><span class="pre">disable_adjust_position()</span></code></a></p>
</div>
<p>Also, <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.enable_adjust_position" title="hyperspy.model.Model.enable_adjust_position"><code class="xref py py-meth docutils literal"><span class="pre">enable_adjust_position()</span></code></a> provides an interactive
way of setting the position of the components with a well define position.
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.disable_adjust_position" title="hyperspy.model.Model.disable_adjust_position"><code class="xref py py-meth docutils literal"><span class="pre">disable_adjust_position()</span></code></a> disables the tool.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/model_adjust_position.png"><img alt="../_images/model_adjust_position.png" src="../_images/model_adjust_position.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Interactive component position adjustment tool.Drag the vertical lines
to set the initial value of the position parameter.</span></p>
</div>
</div>
<div class="section" id="exclude-data-from-the-fitting-process">
<h2>Exclude data from the fitting process<a class="headerlink" href="#exclude-data-from-the-fitting-process" title="Permalink to this headline">¶</a></h2>
<p>The following <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model" title="hyperspy.model.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> methods can be used to exclude
undesired spectral channels from the fitting process:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_signal_range" title="hyperspy.model.Model.set_signal_range"><code class="xref py py-meth docutils literal"><span class="pre">set_signal_range()</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.remove_signal_range" title="hyperspy.model.Model.remove_signal_range"><code class="xref py py-meth docutils literal"><span class="pre">remove_signal_range()</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.reset_signal_range" title="hyperspy.model.Model.reset_signal_range"><code class="xref py py-meth docutils literal"><span class="pre">reset_signal_range()</span></code></a></li>
</ul>
</div>
<div class="section" id="fitting-multidimensional-datasets">
<h2>Fitting multidimensional datasets<a class="headerlink" href="#fitting-multidimensional-datasets" title="Permalink to this headline">¶</a></h2>
<p>To fit the model to all the elements of a multidimensional datataset use
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.multifit" title="hyperspy.model.Model.multifit"><code class="xref py py-meth docutils literal"><span class="pre">multifit()</span></code></a>, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">multifit</span><span class="p">()</span> <span class="c"># warning: this can be a lengthy process on large datasets</span>
</pre></div>
</div>
<p><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.multifit" title="hyperspy.model.Model.multifit"><code class="xref py py-meth docutils literal"><span class="pre">multifit()</span></code></a> fits the model at the first position,
store the result of the fit internally and move to the next position until
reaching the end of the dataset.</p>
<p>Sometimes one may like to store and fetch the value of the parameters at a
given position manually. This is possible using
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.store_current_values" title="hyperspy.model.Model.store_current_values"><code class="xref py py-meth docutils literal"><span class="pre">store_current_values()</span></code></a> and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.fetch_stored_values" title="hyperspy.model.Model.fetch_stored_values"><code class="xref py py-meth docutils literal"><span class="pre">fetch_stored_values()</span></code></a>.</p>
</div>
<div class="section" id="visualising-the-result-of-the-fit">
<h2>Visualising the result of the fit<a class="headerlink" href="#visualising-the-result-of-the-fit" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model" title="hyperspy.model.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.plot_results" title="hyperspy.model.Model.plot_results"><code class="xref py py-meth docutils literal"><span class="pre">plot_results()</span></code></a>,
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component" title="hyperspy.component.Component"><code class="xref py py-class docutils literal"><span class="pre">Component</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.plot" title="hyperspy.component.Component.plot"><code class="xref py py-meth docutils literal"><span class="pre">plot()</span></code></a> and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Parameter" title="hyperspy.component.Parameter"><code class="xref py py-class docutils literal"><span class="pre">Parameter</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Parameter.plot" title="hyperspy.component.Parameter.plot"><code class="xref py py-meth docutils literal"><span class="pre">plot()</span></code></a> methods
can be used to visualise the result of the fit <strong>when fitting multidimensional
datasets</strong>.</p>
</div>
<div class="section" id="saving-and-loading-the-result-of-the-fit">
<h2>Saving and loading the result of the fit<a class="headerlink" href="#saving-and-loading-the-result-of-the-fit" title="Permalink to this headline">¶</a></h2>
<p>As of HyperSpy 0.8, the following is the only way to save a model to  a file
and load it back. Note that this method is known to be brittle i.e. there is no
guarantee that a version of HyperSpy different from the one used to save the
model will be able to load it sucessfully.  Also, it is advisable not to use
this method in combination with functions that alter the value of the
parameters interactively (e.g.  <cite>enable_adjust_position</cite>) as the modifications
made by this functions are normally not stored in the IPython notebook or
Python script.</p>
<p>To save a model:</p>
<ol class="arabic simple">
<li>Save the parameter arrays to a file using
<a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.save_parameters2file" title="hyperspy.model.Model.save_parameters2file"><code class="xref py py-meth docutils literal"><span class="pre">save_parameters2file()</span></code></a>.</li>
<li>Save all the commands that used to create the model to a file. This
can be done in the form of an IPython notebook or a Python script.</li>
<li>(Optional) Comment out or delete the fitting commangs (e.g. <cite>multifit</cite>).</li>
</ol>
<p>To recreate the model:</p>
<ol class="arabic simple">
<li>Execute the IPython notebook or Python script.</li>
<li>Use <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.load_parameters_from_file" title="hyperspy.model.Model.load_parameters_from_file"><code class="xref py py-meth docutils literal"><span class="pre">load_parameters_from_file()</span></code></a> to load back the
parameter values and arrays.</li>
</ol>
</div>
<div class="section" id="exporting-the-result-of-the-fit">
<h2>Exporting the result of the fit<a class="headerlink" href="#exporting-the-result-of-the-fit" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model" title="hyperspy.model.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.export_results" title="hyperspy.model.Model.export_results"><code class="xref py py-meth docutils literal"><span class="pre">export_results()</span></code></a>,
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component" title="hyperspy.component.Component"><code class="xref py py-class docutils literal"><span class="pre">Component</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Component.export" title="hyperspy.component.Component.export"><code class="xref py py-meth docutils literal"><span class="pre">export()</span></code></a> and
<a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Parameter" title="hyperspy.component.Parameter"><code class="xref py py-class docutils literal"><span class="pre">Parameter</span></code></a> <a class="reference internal" href="../api/hyperspy.html#hyperspy.component.Parameter.export" title="hyperspy.component.Parameter.export"><code class="xref py py-meth docutils literal"><span class="pre">export()</span></code></a>
methods can be used to export the result of the optimization in all supported
formats.</p>
</div>
<div class="section" id="batch-setting-of-parameter-attributes">
<h2>Batch setting of parameter attributes<a class="headerlink" href="#batch-setting-of-parameter-attributes" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.6.</span></p>
</div>
<p>The following methods can be used to ease the task of setting some important
parameter attributes:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_not_free" title="hyperspy.model.Model.set_parameters_not_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_not_free()</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_free" title="hyperspy.model.Model.set_parameters_free"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_free()</span></code></a></li>
<li><a class="reference internal" href="../api/hyperspy.html#hyperspy.model.Model.set_parameters_value" title="hyperspy.model.Model.set_parameters_value"><code class="xref py py-meth docutils literal"><span class="pre">set_parameters_value()</span></code></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/hyperspy_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Curve fitting</a><ul>
<li><a class="reference internal" href="#creating-a-model">Creating a model</a></li>
<li><a class="reference internal" href="#adding-components-to-the-model">Adding components to the model</a></li>
<li><a class="reference internal" href="#getting-and-setting-parameter-values-and-attributes">Getting and setting parameter values and attributes</a></li>
<li><a class="reference internal" href="#fitting-the-model-to-the-data">Fitting the model to the data</a></li>
<li><a class="reference internal" href="#visualizing-the-model">Visualizing the model</a></li>
<li><a class="reference internal" href="#setting-the-initial-parameters">Setting the initial parameters</a></li>
<li><a class="reference internal" href="#exclude-data-from-the-fitting-process">Exclude data from the fitting process</a></li>
<li><a class="reference internal" href="#fitting-multidimensional-datasets">Fitting multidimensional datasets</a></li>
<li><a class="reference internal" href="#visualising-the-result-of-the-fit">Visualising the result of the fit</a></li>
<li><a class="reference internal" href="#saving-and-loading-the-result-of-the-fit">Saving and loading the result of the fit</a></li>
<li><a class="reference internal" href="#exporting-the-result-of-the-fit">Exporting the result of the fit</a></li>
<li><a class="reference internal" href="#batch-setting-of-parameter-attributes">Batch setting of parameter attributes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="mva.html"
                        title="previous chapter">Machine learning</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="eels.html"
                        title="next chapter">Electron Energy Loss Spectroscopy</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/model.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="eels.html" title="Electron Energy Loss Spectroscopy"
             >next</a> |</li>
        <li class="right" >
          <a href="mva.html" title="Machine learning"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">HyperSpy 0.8.x+dev documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >HyperSpy User Guide (DRAFT)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, The HyperSpy development team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>